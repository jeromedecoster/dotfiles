#!/bin/bash

ruby=$(type -P ruby)
python=$(type -P python)

# Ruby or Python are not found
# write the error message in the stderr and exit 1
if [[ ! "$ruby" && ! "$python" ]]; then
    echo -e "error: Ruby or Python is required" >&2
    exit 1
fi

# without argument, the path is the pwd
if [[ $# -eq 1 ]]; then
    to="$1"
    from="$(pwd)"
# with 1 argument, the path is this argument
elif [[ $# -eq 2 ]]; then
    to="$1"
    from="$2"
# otherwise write the usage message in the stderr and exit 1
else
    echo 'usage: relpath path_to [path_from]' >&2
    exit 1
fi

if [[ "$ruby" ]]; then
    # for ruby the char ['] must be escaped before the script
    to="$(echo "$to" | sed -e "s/'/\\\'/g")"
    from="$(echo "$from" | sed -e "s/'/\\\'/g")"
    echo "$(ruby -e "require 'pathname'; def x(p); Pathname.new(p).expand_path; end; to=x('$to'); from=x('$from'); puts to.relative_path_from(from)")"
else
    # for python the chars ['\] must be escaped before the script
    to="$(echo "$to" | sed -e "s/\\\/\\\\\\\/g" -e "s/'/\\\'/g")"
    from="$(echo "$from" | sed -e "s/\\\/\\\\\\\/g" -e "s/'/\\\'/g")"
    echo "$(python -c "import os; print(os.path.relpath('$to', '$from'))")"
fi